<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ObedKMV</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
  <style>
    body {
      font-family: "Open Sans", sans-serif;
      background: #f4f4f4;
      padding-top: 2rem;
    }
    .menu-item {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem;
      background: #fff;
      margin-bottom: 1rem;
    }
    .cart-container {
      background: #fff;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #ddd;
    }
    .cart-item {
      border-bottom: 1px solid #eee;
      padding: 0.5rem 0;
    }
    .total {
      font-weight: bold;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="text-center mb-4">
      <h1 class="text-uppercase">Обеды с доставкой</h1>
      <p class="text-muted">Пятигорск, Иноземцево</p>
    </header>

    <h2>Меню</h2>
    <div class="row" id="menu"></div>

    <h2 class="mt-5">Корзина</h2>
    <div class="cart-container" id="cart">
      <p>Корзина пуста.</p>
    </div>

    <div class="mt-3 d-flex justify-content-between">
      <button class="btn btn-secondary" onclick="clearCart()">Очистить корзину</button>
      <button class="btn btn-success" onclick="checkout()">Оформить заказ</button>
    </div>
  </div>

  <script>
    const menuItems = [
      { id: 1, name: "Борщ", price: 150 },
      { id: 2, name: "Котлета с пюре", price: 250 },
      { id: 3, name: "Салат Оливье", price: 120 },
      { id: 4, name: "Компот", price: 60 }
    ];

    let cart = {};

    // === localStorage helpers ===
    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function loadCart() {
      const stored = localStorage.getItem('cart');
      if (stored) {
        cart = JSON.parse(stored);
      }
    }

    // === Menu ===
    function renderMenu() {
      const menu = document.getElementById('menu');
      menu.innerHTML = '';
      menuItems.forEach(item => {
        const div = document.createElement('div');
        div.className = 'col-md-6';
        div.innerHTML = `
          <div class="menu-item">
            <h5>${item.name}</h5>
            <p>Цена: ${item.price} ₽</p>
            <button class="btn btn-primary btn-sm" onclick="addToCart(${item.id})">Добавить</button>
          </div>
        `;
        menu.appendChild(div);
      });
    }

    // === Cart ===
    function renderCart() {
      const cartContainer = document.getElementById('cart');
      cartContainer.innerHTML = '';
      const keys = Object.keys(cart);
      if (keys.length === 0) {
        cartContainer.innerHTML = '<p>Корзина пуста.</p>';
        return;
      }

      let total = 0;
      keys.forEach(key => {
        const item = cart[key];
        total += item.qty * item.price;
        const itemDiv = document.createElement('div');
        itemDiv.className = 'cart-item d-flex justify-content-between align-items-center';
        itemDiv.innerHTML = `
          <div>
            <strong>${item.name}</strong> × ${item.qty} = ${item.qty * item.price} ₽
          </div>
          <div>
            <button class="btn btn-sm btn-outline-danger" onclick="removeFromCart(${item.id})">−</button>
          </div>
        `;
        cartContainer.appendChild(itemDiv);
      });

      const totalDiv = document.createElement('div');
      totalDiv.className = 'total text-right mt-3';
      totalDiv.innerHTML = `Итого: ${total} ₽`;
      cartContainer.appendChild(totalDiv);
    }

    // === Cart operations ===
    function addToCart(id) {
      if (!cart[id]) {
        const item = menuItems.find(i => i.id === id);
        cart[id] = { ...item, qty: 0 };
      }
      cart[id].qty++;
      saveCart();
      renderCart();
    }

    function removeFromCart(id) {
      if (cart[id]) {
        cart[id].qty--;
        if (cart[id].qty <= 0) {
          delete cart[id];
        }
        saveCart();
        renderCart();
      }
    }

    function clearCart() {
      cart = {};
      saveCart();
      renderCart();
    }

    function checkout() {
      const items = Object.values(cart).map(i => `${i.name} × ${i.qty}`).join(', ');
      const total = Object.values(cart).reduce((sum, i) => sum + i.qty * i.price, 0);
      alert(`Ваш заказ: ${items}. Общая сумма: ${total} ₽. Спасибо за заказ!`);
      clearCart();
    }

    // === Initialization ===
    loadCart();
    renderMenu();
    renderCart();
  </script>
</body>
</html>
